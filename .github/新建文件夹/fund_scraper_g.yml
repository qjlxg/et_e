# .github/workflows/scrape_fund_data.yml
name: ğŸ“ˆ åŸºæœ¬èµ„æ–™ CSV

# è§¦å‘æ¡ä»¶é…ç½®
on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - 'fund_scraper_g.py' 
      - 'Cç±».txt'         
      - '.github/workflows/fund_scraper_g.yml' 

jobs:
  scrape_and_push:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 pandas

      # æ­¥éª¤ 4: è¿è¡Œæ•°æ®æŠ“å–è„šæœ¬
      - name: Run fund scraper script
        # ä½¿ç”¨ -u é€‰é¡¹å¼ºåˆ¶ Python ä¸ç¼“å†²è¾“å‡º
        run: python -u fund_scraper_g.py 

      # æ­¥éª¤ 5: é…ç½® Git æäº¤ä¿¡æ¯
      - name: Configure Git
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      # æ­¥éª¤ 6: æ£€æŸ¥å¹¶æäº¤/æ¨é€æ›´æ”¹
      - name: Commit and push changes
        id: commit_push
        run: |
          git add fund_basic_data_c_class.csv
          
          if git diff --cached --exit-code; then
            echo "::notice file=fund_basic_data_c_class.csv::fund_basic_data_c_class.csv æ²¡æœ‰å†…å®¹å˜åŠ¨ï¼Œè·³è¿‡æäº¤å’Œæ¨é€ã€‚"
            echo "push_status=no_change" >> $GITHUB_OUTPUT
          else
            git commit -m "ğŸ“ˆ Update fund_basic_data_c_class.csv (Automated by GitHub Actions)"
            git push
            echo "push_status=success" >> $GITHUB_OUTPUT
          fi
          
      # æ­¥éª¤ 7: æ‰“å°æ¨é€ç»“æœï¼ˆå¯é€‰ï¼‰
      - name: Check push status
        if: steps.commit_push.outputs.push_status == 'success'
        run: echo "ğŸ‰ fund_basic_data_c_class.csv å·²æˆåŠŸæ›´æ–°å¹¶æ¨é€åˆ°ä»“åº“ã€‚"
